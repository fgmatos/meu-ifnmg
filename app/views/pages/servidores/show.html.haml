- ifnmg = { "INST.FED.DE EDUC.,CIENC.E TEC.DO NORTE DE MG" => 158121,
          "INST.FED.DO NORTE DE MG/CAMPUS MONTES CLAROS" => 158437,
          "INST.FED.DO NORTE DE MG/CAMPUS JANUARIA" => 158378,
          "INST.FED.DO NORTE DE MG/CAMPUS SALINAS" => 158377,
          "INST.FED.DO NORTE DE MG/CAMPUS ARINO" => 158438,
          "INST.FED.DO NORTE DE MG/CAMPUS ALMENARA" => 158439,
          "INST.FED.DO NORTE DE MG/CAMPUS PIRAPORA" => 158440,
          "INST.FED DO NORTE DE MG/CAMPUS ARACUAI" => 158441,
          "INST.FED.DO NORTE DE MG/CAMPUS ARINOS" => 158438 }

- link_perfil = "http://www.portaltransparencia.gov.br/servidores/Servidor-ListaServidores.asp?bogus=1&Pagina=1&TextoPesquisa="
- link2  = "http://www.portaltransparencia.gov.br/servidores/Servidor-DetalhaServidor.asp?IdServidor="

.container
  .row
    .col-md-12
      .panel
        .panel-body
          %h2 
            %span.badge(style="font-size: 35px; background-color: white; color: #000000;")
              %span.glyphicon.glyphicon-user
            -#%a(href="#{link_perfil}#{@servidor.nome.gsub(' ', '%20')}" target="_blank" )
            %a{ :href => "#{link_perfil}#{@servidor.nome.gsub(' ', '%20')}",:target=> "_blank", :title => "Pesquisar", :data => {:toggle => "popover", :trigger =>"hover", :content => "Procura o nome do servidor no portal da transparência.", :placement =>"right" } }
              = @servidor.nome
  .row
    .col-md-4
      .panel.panel-default
        -#.panel-heading
          
        .panel-body
          .title
            Informações:
          %b
            CPF:
          = @servidor.cpf
          -# = @servidor.id_servidor_portal
          %br
          %b
            Matrícula: 
          = @servidor.matricula
          %br
          -# %b
            -# Cargo: 
          %label.label.label-default
            = @servidor.descricao_cargo
          %label.label.label-success
            = "Classe #{@servidor.classe_cargo} "
          %label.label.label-primary
            = @servidor.jornada_de_trabalho
          %br
          %b
            Lotação: 
          = @servidor.uorg_lotacao
          %br
          -#%a(href="#{link_perfil}#{@servidor.nome.gsub(' ', '%20')}" target="_blank")
            Procurar no Portal da Transparencia!
          
          %br
          -#%a(href="#{link2}#{@servidor.id_servidor_portal}" target="_blank")
            Servidor on Transparencia!
            
          -# %b
            -# Jornada de trabalho: 
          -# = @servidor.jornada_de_trabalho
          -# %br
          -# %b
            -# Data ingresso (função): 
          -# = @servidor.data_ingresso_cargofuncao.strftime("%d/%m/%Y")
          -# %br
          -# %b
            -# Data ingresso no Orgão: 
          -# = @servidor.data_ingresso_orgao.strftime("%d/%m/%Y") # + " - "
          -#= ( ( Date.today - @servidor.data_ingresso_cargofuncao) / 365 ).to_i
        .panel-footer
          .social-share.text-center
            = render "shared/share"
          -# # .container
            -# # %label.label.label-success
              -# # classe
            -# # %label.label.label-primary
              -# # padrão
            -# # %label.label.label-warning
              -# # Jornada de trabalho
    .col-md-8
      .panel.panel-default
        .panel-body
          .title
            Historico de Remunerações:
            %span.badge
              = "#{@servidor.quant_salarios} meses"
            .pull-right
              Valor:
              %span.badge
                = number_to_currency(@servidor.total_salarios, unit: "R$ ", separator: ",", delimiter: ".").to_s

          -# UL dos Anos
          %ul.nav.nav-tabs
            - anos = []
            - @teste = @minhas_remuneracoes.clone

            - @teste.select(:ano).distinct
            - @teste.each do |data|
              - if !anos.include?(data.ano)
                - anos.push(data.ano)
                %li
                  %a{:data => {:toggle=>"tab"}, :href=>"#tbr#{data.ano}"}
                    = data.ano
                    %span.badge
                      = @servidor.quant_salarios(data.ano)


          .tab-content


            - anos.each do |d|

              %div{ :id => "tbr#{d}", :class=>"tab-pane fade" }
                %br
                %span.badge
                  = "Total recebido no ano: " + number_to_currency(@servidor.total_salarios(d), unit: "R$ ", separator: ",", delimiter: ".").to_s
                .row
                  .panel-group(id="remuneracao#{d}")
                    .panel
                      - @minhas_remuneracoes.where(:ano => d).order('MES ASC').each do |data|
                        .col-md-3
                          .panel-heading
                            %h4.panel-title
                              %a{ :href=>"##{d}#{data.mes}", :data =>{:toggle=>"collapse", :parent=>"#remuneracao#{d}"}}
                                %label.label.label-primary
                                  = data.mes + " - "
                                  = " #{number_to_currency( ( data.remuneracao_basica_bruta_rs.to_f + data.verbas_indenizatorias_civil.to_f + data.gratificacao_natalina_rs.to_f + data.ferias.to_f + data.outras_remuneracoes_eventuais.to_f ) , unit: "R$ ", separator: ",", delimiter: ".").to_s}"
                        .panel-collapse.collapse(id="#{d}#{data.mes}")
                          .panel-body.justify
                            %table.table.table-hover
                              %thead
                                %tr
                                  %th(colspan="11")
                                    %b
                                      %center
                                        Detalhamento da remuneração do mês #{data.mes}/ #{d}
                                %tr
                                  %th
                                    %a{ :href => "#", :title => "Entenda", :data => {:toggle => "popover", :trigger =>"hover", :content => "Remuneração Básica + Incentivo a Qualificação ou Retribuição Titulação + Cargo ou Função (FG ou CD)", :placement =>"right" } }
                                      RB
                                  %th
                                    %a{ :href => "#", :title => "Entenda", :data => {:toggle => "popover", :trigger =>"hover", :content => "Verbas Indenizatórias recebidas pelo servidor como Auxílio Alimentação e Ressarcimento de Saúde", :placement =>"right" } }
                                      VI
                                  %th
                                    %a{ :href => "#", :title => "Entenda", :data => {:toggle => "popover", :trigger =>"hover", :content => "Gratificação Natalina", :placement =>"right" } }
                                      GN
                                  %th Férias
                                  %th
                                    %a{ :href => "#", :title => "Entenda", :data => {:toggle => "popover", :trigger =>"hover", :content => "Outras Remunerações Eventuais", :placement =>"right" } }
                                      ORE
                                  %th
                                    %a{ :href => "#", :title => "Entenda", :data => {:toggle => "popover", :trigger =>"hover", :content => "IImposto de Renda Retido na Fonte", :placement =>"right" } }
                                      IRPF
                                  %th
                                    %a{ :href => "#", :title => "Entenda", :data => {:toggle => "popover", :trigger =>"hover", :content => "Plano de Seguridade Social", :placement =>"right" } }
                                      PSS
                                  %th
                                    %a{ :href => "#", :title => "Entenda", :data => {:toggle => "popover", :trigger =>"hover", :content => "Demais Deduções", :placement =>"right" } }
                                      DD
                                  %th Liquido*
                              %tbody
                                %td
                                  = number_to_currency( data.remuneracao_basica_bruta_rs , unit: "", separator: ",", delimiter: ".").to_s
                                %td
                                  = number_to_currency( data.verbas_indenizatorias_civil , unit: "", separator: ",", delimiter: ".").to_s
                                %td
                                  = number_to_currency( data.gratificacao_natalina_rs, unit: "", separator: ",", delimiter: ".").to_s
                                %td
                                  = number_to_currency( data.ferias, unit: "", separator: ",", delimiter: ".").to_s
                                %td
                                  = number_to_currency( data.outras_remuneracoes_eventuais, unit: "", separator: ",", delimiter: ".").to_s
                                %td
                                  = number_to_currency( data.irrf, unit: "", separator: ",", delimiter: ".").to_s
                                %td
                                  = number_to_currency( data.pss_rpgs, unit: "", separator: ",", delimiter: ".").to_s
                                %td
                                  = number_to_currency( data.demais_deducoes, unit: "", separator: ",", delimiter: ".").to_s
                                %td
                                  = number_to_currency( ( data.remuneracao_basica_bruta_rs.to_f + data.verbas_indenizatorias_civil.to_f + data.gratificacao_natalina_rs.to_f + data.ferias.to_f + data.outras_remuneracoes_eventuais.to_f + data.irrf.to_f + data.pss_rpgs.to_f + data.demais_deducoes.to_f  ) , unit: "", separator: ",", delimiter: ".").to_s
                              %tr
                                %td(colspan="11")
                                  %small
                                    * A contribuição sindical dos servidores públicos não é apresentada no portal da transparência, assim a remuneração liquida de alguns servidores poderá ser 1% menor.


      
      .panel.panel-default
        .panel-body
          .title
            Pedidos de diária:
            %span.badge
              = @minhas_diarias.all.count
            - geral = 0
            - @minhas_diarias.each do |diaria|
              - geral += diaria.valor.to_f
            .pull-right
              Valor:
              %span.badge
                = number_to_currency(geral,unit: "R$ ", separator: ",", delimiter: ".").to_s
        
          %ul.nav.nav-tabs
            - anos = []
            - @minhas_diarias.each do |diaria|
              -# nav tabs creation
              - ano = diaria.data.year
              - if !anos.include?(ano)
                - anos.push(ano)
                %li
                  %a{:data => {:toggle=>"tab"}, :href=>"#tb#{ano}"}
                    = ano.to_s
                    %span.badge
                      = @minhas_diarias.where("data BETWEEN ? AND ? ", ano.to_s + "-01-01", ano.to_s + "-12-31").count
          
          .tab-content
            - anos.each do |ano|
              %div{ :id => "tb#{ano}", :class=>"tab-pane fade" }
                %table.table.table-hover
                  %thead
                    %tr
                      %th Data
                      %th Valor
                      %th Documento
                      %th Unidade
                      -#%th Link
                      
                  %tbody
                    - total = Hash.new
                    - total[ano] = 0 
                      - @minhas_diarias.each do |diaria|
                        %tr
                          - if (diaria.data.year == ano)
                          - total[ano] += diaria.valor.to_f
                          - id_unidade = ifnmg[diaria.nome_unidade].to_s
                          - link = "http://www.portaltransparencia.gov.br/despesasdiarias/pagamento?documento="+ id_unidade +"26410" + diaria.num_doc
                          %td   
                            = diaria.data.strftime("%d/%m/%Y") 
                          %td
                            = number_to_currency(diaria.valor, unit: "R$ ", separator: ",", delimiter: ".").to_s 
                            -# "R$ #{'%.2f' % diaria.valor}"
                          %td
                            %a{ :href => link, :target =>"_blank", :data => {:toggle => "popover", :trigger =>"hover", :content => "#{diaria.nome_unidade}", :placement =>"right" }, :title => "nº #{diaria.num_doc}" }
                              = diaria.num_doc
                          %td
                            = diaria.nome_unidade
                          -#%td
                          -#  = diaria.num_doc
                          
                    %tr
                      %td(colspan="4")
                  %br      
                  %span.badge
                    = "Total de diárias no ano: " + number_to_currency(total[ano],unit: "R$ ", separator: ",", delimiter: ".").to_s
                  

:javascript
  $('[data-toggle="popover"]').popover();
  